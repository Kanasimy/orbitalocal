(function(a){a.HSCore.components.HSCountdown={_baseConfig:{yearsElSelector:".years",monthElSelector:".month",daysElSelector:".days",hoursElSelector:".hours",minutesElSelector:".minutes",secondsElSelector:".seconds",circles:false,wrpClass:"wrpClass",textClass:"textClass",valueStrokeClass:"valueStrokeClass",maxValueStrokeClass:"maxValueStrokeClass",styleWrapper:"styleWrapper",styleText:"styleText"},pageCollection:a(),_circlesIds:[0],init:function(b,c){this.collection=b&&a(b).length?a(b):a();if(!a(b).length){return}this.config=c&&a.isPlainObject(c)?a.extend({},this._baseConfig,c):this._baseConfig;this.config.itemSelector=b;this.initCountdowns();return this.pageCollection},initCountdowns:function(){var b=this;this.collection.each(function(d,e){var f=a(e),c={endDate:f.attr("data-end-date")?(!isNaN(+f.attr("data-end-date"))?new Date(+f.attr("data-end-date")):new Date(f.attr("data-end-date"))):new Date(),startDate:f.data("start-date")?new Date(f.data("start-date")):new Date(),yearsEl:f.find(b.config.yearsElSelector),yearsFormat:f.data("years-format"),monthEl:f.find(b.config.monthElSelector),monthFormat:f.data("month-format"),daysEl:f.find(b.config.daysElSelector),daysFormat:f.data("days-format"),hoursEl:f.find(b.config.hoursElSelector),hoursFormat:f.data("hours-format"),minutesEl:f.find(b.config.minutesElSelector),minutesFormat:f.data("minutes-format"),secondsEl:f.find(b.config.secondsElSelector),secondsFormat:f.data("seconds-format")};if(b.config.circles&&f.data("start-date")){b._initPiesImplementation(f,c)}else{b._initBaseImplementation(f,c)}b.pageCollection=b.pageCollection.add(f)})},_initBaseImplementation:function(b,c){b.countdown(c.endDate,function(d){if(c.yearsEl.length){c.yearsEl.text(d.strftime(c.yearsFormat))}if(c.monthEl.length){c.monthEl.text(d.strftime(c.monthFormat))}if(c.daysEl.length){c.daysEl.text(d.strftime(c.daysFormat))}if(c.hoursEl.length){c.hoursEl.text(d.strftime(c.hoursFormat))}if(c.minutesEl.length){c.minutesEl.text(d.strftime(c.minutesFormat))}if(c.secondsEl.length){c.secondsEl.text(d.strftime(c.secondsFormat))}})},_initPiesImplementation:function(b,d){var c=this,f,e=24*60*60*1000;if(d.yearsEl.length){c._preparePieItem(d.yearsEl,{maxValue:(d.endDate.getFullYear()-d.startDate.getFullYear()),radius:b.data("circles-radius"),width:b.data("circles-stroke-width"),"fg-color":b.data("circles-fg-color"),"bg-color":b.data("circles-bg-color"),"additional-text":b.data("circles-additional-text"),"font-size":b.data("circles-font-size")})}if(d.monthEl.length){c._preparePieItem(d.monthEl,{maxValue:Math.round(Math.abs((d.endDate.getTime()-d.startDate.getTime())/(e)))/12,radius:b.data("circles-radius"),width:b.data("circles-stroke-width"),"fg-color":b.data("circles-fg-color"),"bg-color":b.data("circles-bg-color"),"additional-text":b.data("circles-additional-text"),"font-size":b.data("circles-font-size")})}if(d.daysEl.length){c._preparePieItem(d.daysEl,{maxValue:c._getDaysMaxValByFormat(d.daysFormat,d.startDate,d.endDate),radius:b.data("circles-radius"),width:b.data("circles-stroke-width"),"fg-color":b.data("circles-fg-color"),"bg-color":b.data("circles-bg-color"),"additional-text":b.data("circles-additional-text"),"font-size":b.data("circles-font-size")})}if(d.hoursEl.length){c._preparePieItem(d.hoursEl,{maxValue:60,radius:b.data("circles-radius"),width:b.data("circles-stroke-width"),"fg-color":b.data("circles-fg-color"),"bg-color":b.data("circles-bg-color"),"additional-text":b.data("circles-additional-text"),"font-size":b.data("circles-font-size")})}if(d.minutesEl.length){c._preparePieItem(d.minutesEl,{maxValue:60,radius:b.data("circles-radius"),width:b.data("circles-stroke-width"),"fg-color":b.data("circles-fg-color"),"bg-color":b.data("circles-bg-color"),"additional-text":b.data("circles-additional-text"),"font-size":b.data("circles-font-size")})}if(d.secondsEl.length){c._preparePieItem(d.secondsEl,{maxValue:60,radius:b.data("circles-radius"),width:b.data("circles-stroke-width"),"fg-color":b.data("circles-fg-color"),"bg-color":b.data("circles-bg-color"),"additional-text":b.data("circles-additional-text"),"font-size":b.data("circles-font-size")})}b.countdown(d.endDate,function(g){if(d.yearsEl.length){d.yearsEl.data("circle").update(g.strftime(d.yearsFormat))}if(d.monthEl.length){d.monthEl.data("circle").update(g.strftime(d.monthFormat))}if(d.daysEl.length){d.daysEl.data("circle").update(g.strftime(d.daysFormat))}if(d.hoursEl.length){d.hoursEl.data("circle").update(g.strftime(d.hoursFormat))}if(d.minutesEl.length){d.minutesEl.data("circle").update(g.strftime(d.minutesFormat))}if(d.secondsEl.length){d.secondsEl.data("circle").update(g.strftime(d.secondsFormat))}})},_preparePieItem:function(d,c){var b=this,e=b._circlesIds[b._circlesIds.length-1]+1;b._circlesIds.push(e);d.attr("id","hs-countdown-element-"+e);d.data("circle",Circles.create({id:"hs-countdown-element-"+e,radius:c.radius||80,value:0,maxValue:c.maxValue||100,width:c.width||10,text:function(f){return f+(c["additional-text"]||"")},colors:[c["bg-color"]||"#eeeeee",c["fg-color"]||"#72c02c"],duration:0,wrpClass:b.config.wrpClass,textClass:b.config.textClass,valueStrokeClass:b.config.valueStrokeClass,maxValueStrokeClass:b.config.maxValueStrokeClass,styleWrapper:b.config.styleWrapper,styleText:b.config.styleText}));if(c["font-size"]){d.find("."+b.config.textClass).css("font-size",c["font-size"]+"px")}},_getDaysMaxValByFormat:function(e,b,d){var c=24*60*60*1000;switch(e){case"%D":return Math.round(Math.abs((d.getTime()-b.getTime())/(c)));break;default:return 31}}}})(jQuery);