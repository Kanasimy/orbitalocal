(function(){BX.ready(function(){if(!top.BXIM){return}var g=null;var d=[].slice.call(document.querySelectorAll("a.landing-chat-message"));if(d.length){for(var b=0,f=d.length;b<f;b++){var e=d[b];var a=e.getAttribute("href");if(a){e.addEventListener("click",function(){var c=this.substr(0,5);var h=this.substr(5);if(c==="#chat"){top.BXIM.openMessenger(h)}else{if(c==="#join"){g=h;BX.ajax({url:"/bitrix/tools/landing/ajax.php",method:"POST",data:{action:"Chat::joinChat",data:{internalId:h},sessid:BX.message("bitrix_sessid")},dataType:"json",onsuccess:function(i){if(i.result){top.BXIM.openMessenger("chat"+i.result)}}})}}BX.PreventDefault()}.bind(a))}}}BX.addCustomEvent("onPullEvent-im",function(h,c){if(h==="chatUserAdd"){if(g){console.log(c.users)}}})})})();